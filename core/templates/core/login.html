<!-- core/login.html -->
{% extends 'core/base.html' %}
{% load static %}

{% block title %}Login - Sistema de Gestión de Inmuebles{% endblock %}

{% block content %}
<div class="d-flex justify-content-center align-items-center min-vh-100 p-3">
  <div class="card shadow-sm w-100" style="max-width: 400px;">
    <div class="card-header text-center text-black">
      <img src="{% static 'core/img/logo.png' %}" alt="Logo" style="width: 50px; height: 50px;" class="img-fluid">
      <h4 class="mt-2 mb-0">HomEstate</h4>
      <p>Ingrese sus credenciales para continuar</p>
    </div>

    <!-- Contenedor de mensajes -->
    <div id="messageContainer" class="alert d-none" role="alert"></div>

    <!-- Incluir el formulario como componente -->
    {% include 'core/components/_login_form.html' %}

  </div>
</div>
{% endblock %}

{% block scripts %}
<!-- Firebase -->
<script src="https://www.gstatic.com/firebasejs/9.0.0/firebase-app.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.0.0/firebase-auth.js"></script>
<script>
  const firebaseConfig = {
    apiKey: "TU_API_KEY",
    authDomain: "TU_AUTH_DOMAIN",
    projectId: "TU_PROJECT_ID",
  };
  firebase.initializeApp(firebaseConfig);
  const auth = firebase.auth();
</script>

<script>
  document.addEventListener('DOMContentLoaded', function() {
    const togglePassword = document.querySelector('.toggle-password');
    const passwordInput = document.getElementById('password');
    const rememberCheckbox = document.getElementById('remember');

    // Cargar credenciales si existen
    const savedUsername = localStorage.getItem('username');
    const savedPassword = localStorage.getItem('password');
    if (savedUsername && savedPassword) {
      document.getElementById('email').value = savedUsername;
      document.getElementById('password').value = savedPassword;
      rememberCheckbox.checked = true;
    }

    togglePassword.addEventListener('click', function() {
      const type = passwordInput.getAttribute('type') === 'password' ? 'text' : 'password';
      passwordInput.setAttribute('type', type);
      this.querySelector('i').classList.toggle('fa-eye');
      this.querySelector('i').classList.toggle('fa-eye-slash');
    });
  });

  function showMessage(message, type = 'warning') {
    const container = document.getElementById('messageContainer');
    container.textContent = message;
    container.className = 'alert alert-' + type;
    container.classList.remove('d-none');
    setTimeout(() => {
      container.classList.add('d-none');
    }, 5000);
  }

  function login(event) {
    event.preventDefault();
    const email = document.getElementById('email').value;
    const pass = document.getElementById('password').value;
    const rememberCheckbox = document.getElementById('remember');

    auth.signInWithEmailAndPassword(email, pass)
      .then(userCredential => {
        showMessage('¡Inicio de sesión exitoso! Redirigiendo...', 'success');

        if (rememberCheckbox.checked) {
          localStorage.setItem('username', email);
          localStorage.setItem('password', pass);
        } else {
          localStorage.removeItem('username');
          localStorage.removeItem('password');
        }

        setTimeout(() => {
          window.location.href = "{% url 'admin-dashboard' %}";
        }, 1000);
      })
      .catch(error => {
        showMessage('Error de inicio de sesión: ' + error.message, 'danger');
      });
  }

  // Funcionalidades de enlaces de registro y recuperación
  document.addEventListener('DOMContentLoaded', function() {
    document.getElementById('registerLink').addEventListener('click', function(e) {
      e.preventDefault();
      alert('Funcionalidad de registro en desarrollo');
    });

    document.querySelector('.forgot-password').addEventListener('click', function(e) {
      e.preventDefault();
      alert('Funcionalidad de recuperación de contraseña en desarrollo');
    });
  });
</script>
{% endblock %}
